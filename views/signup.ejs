<!--EJS for the signup page-->
<!DOCTYPE html>
<html lang='en'>
 <head>
    <meta charset="UTF-8">
    <!-- MAKE CSS LATER
      <link rel="stylesheet"
        type="text/css"
        href="index.css">
    -->
    <title>Sign up page</title>
 </head>
    <body>

        <!--Form for signing up user and error messages-->
        <!--ADD CSS LATER-->
        <form>
            <h2>Sign up</h2>
            <label for="email">Email</label>
            <input type="text" name="email" required />
            <div class="email error"></div>
            <label for="password">Password</label>
            <input type="password" name="password" required />
            <div class="password error"></div>
            <button>Sign up</button> <!--Submit event will automatically be done-->
        </form>
    
    <script>
        const form = document.querySelector('form')
        const emailError = document.querySelector('.email.error')
        const passwordError = document.querySelector('.password.error')

        form.addEventListener('submit', async (e) => {
            e.preventDefault() //Prevent the refresh when submitted

            //Reset errors (clears errors so they don't keep happening)
            emailError.textContent = ''
            passwordError.textContent = ''

            //Get the values (using name, can use form.<name>)
            const email = form.email.value
            const password = form.password.value

            //log to console (the console in the developer tools page!! not powershell!)
            //Send request to the user using fetch
            try {
                const res = await fetch('/signup', {
                    method: 'POST',
                    //Can pass it as so as it has the same name as the value or use email: email, password: password
                    body: JSON.stringify({ email, password }),
                    //Send it as json to the server and DB if succusful
                    headers: { 'Content-Type': 'application/json' }
                })
                //get data out of it using data method
                const data = await res.json()
                //log to console to check it
                console.log(data)

                //Handeling any errors in signup
                if (data.errors) {
                    //Change text content to show it
                    emailError.textContent = data.errors.email
                    passwordError.textContent = data.errors.password
                    //Reset errors everytime we submit; so when it's updated to a valid user we won't get errors still!
                
                }
                //Detect if we now have a user and if we do send them to the home page
                if (data.user) {
                    //Redirect the user to the home page
                    location.assign('/')
                }                
            } catch (err) {
                console.log(err)
            }
        })
    </script>
    </body>
</html>